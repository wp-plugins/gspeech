(function($){$(document).ready(function(){function check_pro_version(){if($("#gspeech_wrapper").is(":visible"))return true;return false}$("#gspeech_wrapper").mousedown(function(e){return false});document.onmousedown=function(e){if(!isMyDiv(e)&&isVissible()){hide_speaker();clearSelection()}else{if(isVissible()&&isMyDiv(e)){if(!sound_container_clicked){if(!check_pro_version()){alert('To hide a backlink please purchase a GSpeech PRO version');return false}var a=document.all?true:false;make_audio();if(a)blink_speaker();else rotate_speaker();sound_container_clicked=true}else{clearSelection();hide_speaker()}e.preventDefault()}else clearSelection()}};$("body").keydown(function(e){if(e.keyCode==13){if(isVissible()){if(!sound_container_clicked){if(!check_pro_version()){alert('To hide a backlink please purchase a GSpeech PRO version');return false}var a=document.all?true:false;make_audio();if(a)blink_speaker();else rotate_speaker();sound_container_clicked=true}else{clearSelection();hide_speaker()}}}});function clearSelection(){if(window.getSelection){if(window.getSelection().empty){window.getSelection().empty()}else if(window.getSelection().removeAllRanges){window.getSelection().removeAllRanges()}}else if(document.selection){document.selection.empty()}};function hide_speaker(){clearAllPlayers();$('#sound_container').fadeTo(10,1);$('#sound_container').fadeOut(300);for(f in blink_timer){clearTimeout(blink_timer[f])}for(ff in rotate_timer){clearInterval(rotate_timer[ff])}sound_container_clicked=false;blinking_enable=true;sound_container_visible=true;$("#gspeech_wrapper").fadeOut(300)};function stop_speaker(){clearAllPlayers();$("#sound_container").rotate({animateTo:360});$('#sound_container').fadeTo(10,1);for(f in blink_timer){clearTimeout(blink_timer[f])}for(f in rotate_timer){clearInterval(rotate_timer[f])}sound_container_clicked=false;blinking_enable=true;sound_container_visible=true};document.onmouseup=function(e){if(!basic_plg_enable)return;selected_txt=GetSelectedText();if(!isMyDiv(e)&&!sound_container_clicked){var a=/^(\s)*$/gi;var b=a.test(selected_txt);if(b)selected_txt='';if(selected_txt!=''&&selected_txt!=undefined&&selected_txt.length>1&&!b){var c=get_coord(e);var x=c[0];var y=c[1];move_sound_container(x,y,selected_txt)}}};$("#gspeech_wrapper").mouseup(function(e){return false});function rotate_speaker(){var a=0;rotate_timer_element=setInterval(function(){a+=3;$("#sound_container").rotate(a)},15);rotate_timer.push(rotate_timer_element)};function blink_speaker(){if(sound_container_visible){$('#sound_container').fadeTo(200,0.2);sound_container_visible=false}else{$('#sound_container').fadeTo(200,1);sound_container_visible=true}blink_timer.push(setTimeout(blink_speaker,800))};function change_speaker_animation(){if(!($("#sound_container").is(":visible")))return;if(blinking_enable){for(f in rotate_timer){clearInterval(rotate_timer[f])}$("#sound_container").rotate({animateTo:0});blink_speaker()}blinking_enable=false};function isVissible(){var a=$('#sound_container').css('display');if(a=='block')return true;else return false};function isMyDiv(e){if(typeof event=="undefined")var x=e.target||e.srcElement;else var x=event.target||event.srcElement;var a=x.id;if(a=='sound_container')return true;else return false};function move_sound_container(x,y,a){var b=x*1+5;var c=y*1-5;$('#sound_container').css({left:b,top:c});$("#sound_container").rotate(0);$('#sound_container').fadeIn(400);$('#sound_text').html(a);$('#gspeech_wrapper').css({left:b,top:c+43*1}).fadeTo(300,1)};function make_audio(){selected_txt=$('#sound_text').html();var g=new Array(),sent_array=new Array(),sent_index=0;g=selected_txt.split(/[^\S]+/);for(var i=0;i<g.length;i++){if(sent_array[sent_index]==undefined){sent_array[sent_index]=''}var h=sent_array[sent_index].length+g[i].length;if(sent_array[sent_index].length<speech_text_length&&h<speech_text_length){sent_array[sent_index]+=g[i]+' '}else{++sent_index;sent_array[sent_index]=g[i]+' '}};var j=sent_array.length;var k='';for(var i=0;i<j;i++){k+='<audio id="player'+i+'" src="'+streamerphp_folder+'speech.mpeg" type="'+translation_audio_type+'" controls="controls"></audio>'}$("#sound_audio").html(k);for(var i=0;i<j;i++){create_htm(i,j)};function create_htm(i,f){$('#player'+i).mediaelementplayer({success:function(a,b){players[i]=a;var c=encodeURIComponent(sent_array[i]);var d=streamerphp_folder+'streamer.php?q='+c+'&l='+lang_identifier+'&tr_tool='+translation_tool;a.setSrc(d);a.addEventListener('pause',function(e){try{players[i+1].play()}catch(e){}},false);players[0].addEventListener('progress',function(e){change_speaker_animation()},false);if(i==f-1){players[f-1].addEventListener('pause',function(e){stop_speaker()},false)}a.load();if(i==0){a.play()}}})}};function GetSelectedText(){var c="",selTextParts=[];function getNodeText(a){if(a.nodeType==3){selTextParts.push(a.data)}else if(a.hasChildNodes()&&!(a.nodeType==1&&/^(script|style)$/i.test(a.tagName))){for(var b=a.firstChild;!!b;b=b.nextSibling){getNodeText(b)}}};if(window.getSelection){var d=window.getSelection(),rangeCount=d.rangeCount;if(rangeCount){for(var i=0;i<rangeCount;++i){getNodeText(d.getRangeAt(i).cloneContents())}c=selTextParts.join("")}}else if(document.selection&&document.selection.type=="Text"){c=document.selection.createRange().text}return c};function get_coord(e){var a=document.all?true:false;var b,pos_y;if(!a){b=e.pageX;pos_y=e.pageY}if(a){var c=document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft;b=event.clientX+c;var d=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop;pos_y=event.clientY+d}return[b,pos_y]};function clearAllPlayers(){for(var c in players){players[c]=''}$('#sound_audio').html('')}})})(jQuery);